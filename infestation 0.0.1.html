<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Infestation</title>
<style>
/* -------------------------------------------------------------
   GLOBAL LAYOUT
------------------------------------------------------------- */
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#111;
  color:#eee;
  overflow:hidden;
}
.screen{display:none;height:100vh;box-sizing:border-box;}
.active{display:flex;}

/* -------------------------------------------------------------
   START SCREEN
------------------------------------------------------------- */
#startScreen{
  flex-direction:column;
  justify-content:center;
  align-items:center;
  background:linear-gradient(135deg,#220022,#001122);
}
#startScreen h1{font-size:3rem;margin-bottom:.5rem;}
#startScreen p{font-size:1.2rem;max-width:500px;text-align:center;}
#startBtn{
  margin-top:2rem;padding:.8rem 1.6rem;font-size:1.2rem;
  background:#00ff00;color:#000;border:none;cursor:pointer;
  border-radius:.4rem;
}
#startBtn:hover{background:#33ff33;}

/* -------------------------------------------------------------
   MAIN GAME SCREEN (sidebar + main area)
------------------------------------------------------------- */
#gameScreen{flex-direction:row;}

/* ----- Sidebar (always visible) ----- */
#sidebar{
  width:300px;
  background:#1a1a2d;
  padding:1rem;
  box-sizing:border-box;
  overflow-y:auto;
}

/* ----- Header row (date | time | money) ----- */
#headerRow{
  display:flex;
  justify-content:space-between;
  font-size:.9rem;
  margin-bottom:1rem;
}

/* ----- Character description ----- */
#charDesc{
  font-size:.85rem;
  margin-bottom:.8rem;
  color:#88ff88;
}

/* -------------------------------------------------
   NEED LAYOUT – thin full‑width bar, name & label on ONE line
   ------------------------------------------------- */

.need{
  margin-bottom:0.2rem;
  position:relative;
}

/* header that holds the combined “Name: Label” line */
.needHeader{
  display:flex;
  justify-content:center;
  margin-bottom:0.2rem;               /* space between text and bar */
}

/* the single line – we’ll fill it via JS */
.needLine{
  font-size:.85rem;
  color:#fff;                      /* name part is white */
}

/* the label part (after the colon) will be coloured by JS */
.needLine .stage{
  color:#ccc;                      /* fallback colour */
}

/* thin, sharp‑edge bar */
.bar{
  width:100%;
  height:6px;                      /* thin rectangle */
  background:#444;
  overflow:hidden;
}

/* coloured fill – colour set by JS */
.fill{
  height:100%;
  display:block;
}

/* -------------------------------------------------
   HIDDEN (“bad”) needs – show only the stage label
   ------------------------------------------------- */
.noName .needLine{
  /* show the line (previously hidden) */
  display:flex;               /* keep flex so the label aligns nicely */
  justify-content:center;
  margin-left:0.2rem;         /* tiny indent so it lines up with other lines */
}

/* the stage label inside a hidden need – colour will be set by JS */
.noName .needLine .stage{
  /* fallback colour – will be overridden */
  color:#aaa;
}

/* -------------------------------------------------
   TOOLTIP (shows name in white + % in bar colour)
   ------------------------------------------------- */
.tooltip{
  position:absolute;
  left:50%;
  bottom:120%;
  transform:translateX(-50%);
  padding:.3rem .5rem;
  background:#222;
  color:#fff;
  font-size:.75rem;
  white-space:nowrap;
  border-radius:3px;
  opacity:0;
  pointer-events:none;
  transition:opacity .15s ease;
  z-index:10;
}
.tooltip::after{
  content:"";
  position:absolute;
  top:100%;
  left:50%;
  transform:translateX(-50%);
  border-width:5px 5px 0 5px;
  border-style:solid;
  border-color:#222 transparent transparent transparent;
}
.need:hover .tooltip{
  opacity:1;
}

/* ---- Bottom button bar – each button on its own row, full width ---- */
#bottomButtons{
  display:flex;
  flex-direction:column;          /* stack vertically */
  margin-top:9rem;
  gap:.4rem;
}

/* generic button – fills the whole row */
.bottomBtn{
  flex:1 0 auto;                  /* take full width of its row */
  width:100%;
  padding:.4rem .6rem;
  box-sizing:border-box;

  /* NEW – visual styling */
  background:#444;                /* dark‑gray background (feel free to adjust) */
  color:#fff;                     /* white text for contrast */
  border:2px solid transparent;   /* invisible border so the button size doesn’t jump on hover */
  border-radius:4px;              /* optional rounded corners */
  transition:border-color .15s ease, background .15s ease; /* smooth hover effect */
}

/* Hover state – green border */
.bottomBtn:hover{
  background:#555;                /* a slightly lighter gray while hovered (optional) */
  border-color:#00ff00;           /* bright green border on hover */
}
/* -----------------------------------------------------------------
   OVERLAY BUTTON STYLE – independent from the global style
   ----------------------------------------------------------------- */
.overlayBtn{
  /* Reset anything that the global .bottomBtn forced */
  width:auto !important;          /* ignore the global width:100% */
  flex:0 1 auto;                  /* allow shrinking, no forced growth */
  display:inline-block;           /* size to its intrinsic content */
  padding:.35rem .6rem;           /* comfortable click/tap area */
  margin:0 .2rem;                 /* tiny gap between neighbour elements */
  min-width:0;                    /* clear any inherited min‑width */
  box-sizing:border-box;          /* include padding in the width */
}

/* OPTIONAL: give overlay buttons a distinct look (colour, hover, etc.) */
.overlayBtn{
  background:#222;                /* darker background than sidebar buttons */
  color:#00ff00;                  /* bright green text – matches the UI theme */
  border:1px solid #00ff00;
  border-radius:4px;
}
.overlayBtn:hover{
  background:#333;
}

/* ---- Settings / Cheats when cheats are enabled ---------------------- */
/* the body gets the class “cheats-enabled” when the checkbox is ticked */
body.cheats-enabled #bottomButtons{
  flex-direction:row;             /* switch to a horizontal row */
  flex-wrap:wrap;
}

/* each takes ≈½ of the line */
body.cheats-enabled .settingsBtn,
body.cheats-enabled .cheatsBtn{
  flex:1 1 48%;                   /* half‑width, leave a tiny gap */
  width:auto;                    /* let flex control width */
}

/* keep the Settings button left‑aligned, Cheats button on the right */
body.cheats-enabled .settingsBtn{margin-right:auto;}
body.cheats-enabled .cheatsBtn{margin-left:auto;}

/* -------------------------------------------------------------
   MAIN AREA (rooms / events)
------------------------------------------------------------- */
#mainArea{
  flex:1;
  position:relative;
  padding:1.5rem;
  overflow-y:auto;
}

/* Text styles */
.eventTitle{font-size:1.8rem;margin-top:0;color:#00ff00;}
.eventText{margin:1rem 0;line-height:1.4;}
.link{color:#00ff00;cursor:pointer;text-decoration:underline;}
.link:hover{color:#33ff33;}

/* -------------------------------------------------------------
   NAVIGATION COLUMN (absolute, anchored below text)
------------------------------------------------------------- */
.navColumn{
  position:absolute;
  left:15%;
  display:flex;
  flex-direction:column;
  gap:.6rem;
}
.navColumn .link{font-size:1.1rem;}

/* -------------------------------------------------------------
   OVERLAY WINDOWS (square, 30 % of viewport width)
------------------------------------------------------------- */
.overlay{
  position:fixed;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  background:#222;
  border:2px solid #00ff00;
  padding:1rem;
  width:65vw;
  height:45vw;
  max-width:80;
  max-height:80;
  z-index:1000;
  display:none;
}
.overlayHeader{
  font-weight:bold;
  margin-bottom:.6rem;
  color:#00ff00;
}
.overlayClose{
  position:absolute;
  top:.4rem;
  right:.6rem;
  cursor:pointer;
  color:#ff5555;
}
.overlayBody{margin-top:1.2rem;}

/* -------------------------------------------------------------
   BOTTOM BUTTON BAR – definitions (kept for reference)
------------------------------------------------------------- */
/* (the actual buttons are now written directly in the HTML) */

/* -------------------------------------------------------------
   RESPONSIVE ADJUSTMENTS (optional)
------------------------------------------------------------- */
@media (max-width:600px){
  #sidebar{width:100%;height:auto;}
  #gameScreen{flex-direction:column;}
}
</style>
</head>
<body>

<!-- ==================== START SCREEN ==================== -->
<section id="startScreen" class="screen active">
  <h1>Infestation</h1>
  <p>
    Maya has been unlucky enough to become host to a worm‑like alien parasite.
    Manage her physical and mental state while she tries to uncover the truth.
  </p>
  <button id="startBtn">Begin</button>
</section>

<!-- ==================== MAIN GAME SCREEN ==================== -->
<section id="gameScreen" class="screen">
  <!-- ---------- Sidebar (always visible) ---------- -->
  <aside id="sidebar">
    <h3>Game Info</h3>

    <!-- Header row: Date | Time | Money -->
    <div id="headerRow">
      <span id="date">01 Aug 2025</span>
      <span id="clock">09:00</span>
      <span id="money">$0.00</span>
    </div>

    <!-- Character description -->
    <div id="charDesc">Wearing: lab coat, sneakers</div>

<!-- ==================== NEED CONTAINERS (NEW LAYOUT) ==================== -->

<!-- regular needs -->
<div class="need" id="need-tiredness"
     data-name="Fatigue"
     data-labels="Exhausted|Very Tired|Tired|Alert|Energized">
  <div class="needHeader">
    <span class="needLine"><!-- filled by JS --> </span>
  </div>
  <div class="bar"><span class="fill"></span></div>
  <div class="tooltip"></div>
</div>

<div class="need" id="need-stress"
     data-name="Stress"
     data-labels="Panicked|Very Stressed|Stressed|Calm|Relaxed">
  <div class="needHeader">
    <span class="needLine"></span>
  </div>
  <div class="bar"><span class="fill"></span></div>
  <div class="tooltip"></div>
</div>

<div class="need" id="need-trauma"
     data-name="Trauma"
     data-labels="Shattered|Severely Traumatized|Traumatized|Stable|Secure">
  <div class="needHeader">
    <span class="needLine"></span>
  </div>
  <div class="bar"><span class="fill"></span></div>
  <div class="tooltip"></div>
</div>

<div class="need" id="need-happiness"
     data-name="Happiness"
     data-labels="Depressed|Very Unhappy|Unhappy|Content|Joyful">
  <div class="needHeader">
    <span class="needLine"></span>
  </div>
  <div class="bar"><span class="fill"></span></div>
  <div class="tooltip"></div>
</div>

<div class="need" id="need-arousal"
     data-name="Arousal"
     data-labels="Numb|Very Low|Low|Normal|High">
  <div class="needHeader">
    <span class="needLine"></span>
  </div>
  <div class="bar"><span class="fill"></span></div>
  <div class="tooltip"></div>
</div>

<!-- hidden / “bad” needs – keep hidden until shown -->
<div class="need hiddenBar noName" id="need-corruption"
     data-name="Corruption"
     data-labels="None|Trace|Low|Medium|High">
  <div class="needHeader"><span class="needLine"></span></div>
  <div class="bar"><span class="fill"></span></div>
  <div class="tooltip"></div>
</div>

<div class="need hiddenBar noName" id="need-alcohol"
     data-name="Alcohol"
     data-labels="Sober|Buzzed|Tipsy|Drunk|Wasted">
  <div class="needHeader"><span class="needLine"></span></div>
  <div class="bar"><span class="fill"></span></div>
  <div class="tooltip"></div>
</div>

<div class="need hiddenBar noName" id="need-drugs"
     data-name="Drugs"
     data-labels="Clean|Mild|Moderate|Heavy|Overdose">
  <div class="needHeader"><span class="needLine"></span></div>
  <div class="bar"><span class="fill"></span></div>
  <div class="tooltip"></div>
</div>

    <!-- Bottom button bar (static HTML – JS will attach handlers) -->
    <div id="bottomButtons">
      <button id="btnChar"    class="bottomBtn">Character</button>
      <button id="btnSocial"  class="bottomBtn">Social</button>
      <button id="btnJournal" class="bottomBtn">Journal</button>
      <button id="btnSaves"   class="bottomBtn">Saves</button>

      <!-- Settings button – always visible -->
      <button id="btnSettings" class="bottomBtn settingsBtn">Settings</button>

      <!-- Cheats button – hidden until checkbox is ticked -->
      <button id="cheatsBtn"   class="bottomBtn cheatsBtn" style="display:none;">Cheats</button>
    </div>
  </aside>

  <!-- ---------- Main area (events / rooms) ---------- -->
  <main id="mainArea">
    <!-- Content will be injected by JavaScript -->
  </main>
</section>

<!-- SETTINGS overlay (square, 30 % of viewport width) -->
<div id="btnSettings-overlay" class="overlay settingsOverlay">
  <div class="overlayHeader">Settings</div>
  <div class="overlayClose" onclick="closeAllOverlays()">✖</div>
  <div class="overlayBody">
    <label style="display:flex;align-items:center;gap:.4rem;">
      <input type="checkbox" id="cheatsChk" onchange="toggleCheats(this)">
      Enable Cheats
    </label>
  </div>
</div>

<!-- CHEATS overlay (same square size) -->
<div id="cheatsBtn-overlay" class="overlay cheatsOverlay">
  <div class="overlayHeader">Cheats</div>
  <div class="overlayClose" onclick="closeAllOverlays()">✖</div>
  <div class="overlayBody">
    <!-- Cheat controls will be inserted by JS later -->
  </div>
</div>
<script>
/* ==============================================================
   GLOBAL STATE
   ============================================================== */
const state = {
  /* -------------------- Time -------------------- */
  currentTime: new Date('2007-08-01T09:00:00'),   // start time (unchanged)

  /* -------------------- Money ------------------- */
  money: 0.00,

  /* -------------------- Intro events ------------ */
  eventIndex: 0,
  events: [
    {title:"Meet Maya",text:"Maya Alvarez, a marine biologist, woke up feeling a strange pressure in her abdomen. An alien worm‑like parasite has taken residence inside her, feeding off her nervous system."},
    {title:"Friend – Leah",text:"Leah Patel, Maya’s longtime friend, calls to check in. She senses something is off but Maya brushes it aside."},
    {title:"Friend – Amir",text:"Dr. Amir Khan, a neuro‑biology researcher, offers to run scans. He warns Maya about the risks of unknown pathogens."},
    {title:"Friend – Toby",text:"Toby, the lab’s tech specialist, jokes about “alien pets.” He hands Maya a bottle of energy drink."}
  ],

  /* -------------------- Needs ------------------- */
  needs: {
    tiredness: 10000,
    stress: 0,
    trauma: 0,
    happiness: 1000,
    arousal: 0,
    corruption: 0,
    alcohol: 0,
    drugs: 0
  },

  ranges: {
    tiredness: 10000,
    stress: 1000,
    trauma: 1000,
    happiness: 1000,
    arousal: 1000,
    corruption: 1000,
    alcohol: 100,
    drugs: 100
  },

  /* -------------------- Flags -------------------- */
  showCorruption: false,   // toggled from Cheats overlay
  cheatsEnabled: false     // set by Settings → Enable Cheats
};

/* ==============================================================
   UTILS
   ============================================================== */
function fmtHM(d){ return d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit',hour12:false}); }
function fmtDate(d){ return d.toLocaleDateString(); }

/* Add 30 seconds to the clock and refresh the header */
function advanceTime(){
  state.currentTime = new Date(state.currentTime.getTime() + 30_000);
  updateHeader();
}

/* ==============================================================
   HEADER (date | time | money)
   ============================================================== */
function updateHeader(){
  document.getElementById('clock').textContent = fmtHM(state.currentTime);
  document.getElementById('date' ).textContent = fmtDate(state.currentTime);
  document.getElementById('money').textContent = `$${state.money.toFixed(2)}`;
}

/* ==============================================================
   NEEDS UI
   ============================================================== */
function getFillPct(k){
  const cur = state.needs[k];
  const max = state.ranges[k];
  return Math.min(100, Math.max(0, (cur / max) * 100));
}

/* Simple stage labels (just for visual flavour) */
function stageLabel(p){
  if(p===0) return 'Stage 0';
  if(p<=33) return 'Stage 1';
  if(p<=66) return 'Stage 2';
  if(p<=99) return 'Stage 3';
  if(p=100) return 'Stage 4';
}

function updateNeedsUI(){
  Object.keys(state.needs).forEach(k=>{
    const el   = document.getElementById(`need-${k}`);
    if(!el) return;

    const pct  = getFillPct(k);                     // 0‑100 %
    const fill = el.querySelector('.fill');
    const line = el.querySelector('.needLine');

    /* ---------- colour (original dynamic logic) ---------- */
    const inverted = ['stress','trauma','arousal'].includes(k);
    const r = Math.round(255 * (inverted ? pct/100 : 1-pct/100));
    const g = Math.round(255 * (inverted ? 1-pct/100 : pct/100));
    const barColor = `rgb(${r},${g},0)`;

    fill.style.width = pct + '%';
    fill.style.background = barColor;               // thin bar colour
    

    /* ---------- stage label ---------- */
    const labels = el.getAttribute('data-labels').split('|');
    const idx = Math.min(labels.length-1, Math.floor(pct/20)); // 0‑4
    const stage = labels[idx];

    /* ---------- compose “Name: Stage” line ----------
       – for normal needs we show the name, for hidden ones we hide it
    */
    const needName = el.getAttribute('data-name');
    if(el.classList.contains('noName')){
      // hidden needs: only the stage (no name)
      line.innerHTML = `<span class="stage" style="color:${barColor};">${stage}</span>`;
    }else{
      // normal needs: “Name: Stage” on one line
      line.innerHTML = `
        <span style="color:#fff;">${needName}:</span>
        <span class="stage" style="color:${barColor}; margin-left:.4rem;">${stage}</span>
      `;
    }

    /* ---------- tooltip (name white + % coloured) ---------- */
    const tooltip = el.querySelector('.tooltip');
    tooltip.innerHTML = `
      <span style="color:#fff;">${needName}</span>
      <span style="color:${barColor}; margin-left:.4rem;">${pct.toFixed(0)}%</span>
    `;

    /* ---------- empty‑text colour handling (unchanged) ---------- */
    if(!inverted && pct===0 && !el.classList.contains('noName')){
      line.classList.add('empty');
    }else{
      line.classList.remove('empty');
    }
  });

  /* ---- visibility of the “bad” needs (unchanged) ---- */
  document.getElementById('need-alcohol')
          .style.display = state.needs.alcohol>0 ? 'block' : 'none';
  document.getElementById('need-drugs')
          .style.display = state.needs.drugs>0 ? 'block' : 'none';

  const corr = document.getElementById('need-corruption');
  if(state.showCorruption){
    corr.classList.remove('hiddenBar');
    corr.style.display = 'block';
  }else{
    corr.classList.add('hiddenBar');
    corr.style.display = 'none';
  }
}

/* ==============================================================
   SCREEN SWITCHING
   ============================================================== */
function switchScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

/* ==============================================================
   INTRO EVENT SEQUENCE (no time advance while reading)
   ============================================================== */
function showCurrentEvent(){
  const c = document.getElementById('mainArea');
  c.innerHTML = '';

  const ev = state.events[state.eventIndex];

  const title = document.createElement('h2');
  title.className = 'eventTitle';
  title.textContent = ev.title;
  c.appendChild(title);

  const txt = document.createElement('p');
  txt.className = 'eventText';
  txt.textContent = ev.text;
  c.appendChild(txt);

  const link = document.createElement('span');
  link.className = 'link';
  link.textContent = (state.eventIndex < state.events.length-1) ? 'Continue →' : 'Enter the Lab →';
  link.onclick = () => {
    if(state.eventIndex < state.events.length-1){
      state.eventIndex++;
      showCurrentEvent();          // **no** advanceTime here
    }else{
      renderFoyer();               // entering the lab starts the map
    }
  };
  c.appendChild(link);
}

/* ==============================================================
   MAP – FOYER AND ROOMS (each move advances time)
   ============================================================== */
function renderFoyer(){
  const c = document.getElementById('mainArea');
  c.innerHTML = `
    <h2 class="eventTitle">Laboratory Foyer</h2>
    <p class="eventText" id="foyerDesc">
      The foyer is dimly lit, metal doors line the walls, and a low hum of equipment
      reverberates through the concrete floor. A faint smell of antiseptic hangs in the air.
    </p>
    <div class="navColumn" id="foyerNav"></div>
  `;
  const nav = document.getElementById('foyerNav');
  nav.innerHTML = `
    <span class="link" onclick="renderRoom('kitchen')">Kitchen</span>
    <span class="link" onclick="renderRoom('lounge')">Lounge</span>
    <span class="link" onclick="renderRoom('bathroom')">Bathroom</span>
  `;
  positionNavBelow(document.getElementById('foyerDesc'), nav);
  advanceTime();                     // moving into the foyer costs 30 s
}

function renderRoom(name){
  const c = document.getElementById('mainArea');
  let title='',desc='';

  if(name==='kitchen'){
    title='Kitchen';
    desc=`Stainless steel counters glint under harsh fluorescent lights. A coffee maker gurgles,
           and a half‑eaten sandwich rests on a plate. The scent of stale coffee lingers.
           The fridge hums softly, casting a faint blue glow across the tiled floor.`;
  }else if(name==='lounge'){
    title='Lounge';
    desc=`Plush chairs face a wall‑mounted screen playing calming nature footage.
           Shelves hold scientific journals and a few well‑worn novels. Soft ambient music drifts.`;
  }else if(name==='bathroom'){
    title='Bathroom';
    desc=`White tiles line the walls, a single sink flickers with a weak bulb. The mirror fogs
           slightly as warm air circulates. A small cabinet holds basic toiletries.`;
  }

  c.innerHTML = `
    <h2 class="eventTitle">${title}</h2>
    <p class="eventText" id="roomDesc">${desc}</p>
    <div class="navColumn" id="roomNav"></div>
  `;
  const nav = document.getElementById('roomNav');
  nav.innerHTML = `<span class="link" onclick="renderFoyer()">Back to Foyer</span>`;
  positionNavBelow(document.getElementById('roomDesc'), nav);
  advanceTime();                     // each room transition adds 30 s
}

/* Helper – positions a .navColumn just below a given element */
function positionNavBelow(targetEl, navEl){
  const parent = document.getElementById('mainArea').getBoundingClientRect();
  const tgt    = targetEl.getBoundingClientRect();
  const pct = ((tgt.bottom - parent.top) / parent.height) * 100;
  navEl.style.top = `${pct + 2}%`;   // small gap
}

/* ==============================================================
   BOTTOM BUTTONS & OVERLAYS
   ============================================================== */
function initBottomButtons(){
  // Character / Social / Journal / Saves – placeholder handlers (you can flesh out)
  document.getElementById('btnChar'   ).onclick = () => openOverlay('btnChar');
  document.getElementById('btnSocial' ).onclick = () => openOverlay('btnSocial');
  document.getElementById('btnJournal').onclick = () => openOverlay('btnJournal');
  document.getElementById('btnSaves'  ).onclick = () => openOverlay('btnSaves');

  // Settings button – opens its overlay
  document.getElementById('btnSettings').onclick = () => openOverlay('btnSettings');

  // Cheats button – appears only after the checkbox is ticked
  document.getElementById('cheatsBtn'  ).onclick = () => openOverlay('cheatsBtn');
}

/* Generic overlay toggler (click again to hide) */
function openOverlay(btnId){
  const ov = document.getElementById(`${btnId}-overlay`);
  if(!ov) return;

  // toggle visibility
  if(ov.style.display === 'block'){
    ov.style.display = 'none';
  }else{
    closeAllOverlays();
    ov.style.display = 'block';
  }
}

/* Hide every overlay */
function closeAllOverlays(){
  document.querySelectorAll('.overlay').forEach(o=>o.style.display='none');
}

/* --------------------------------------------------------------
   SETTINGS → CHEATS CHECKBOX
   -------------------------------------------------------------- */
function toggleCheats(cb){
  state.cheatsEnabled = cb.checked;

  // add/remove a class that drives the CSS layout
  if(state.cheatsEnabled) document.body.classList.add('cheats-enabled');
  else                       document.body.classList.remove('cheats-enabled');

  // show / hide the Cheats button (CSS already handles width)
  document.getElementById('cheatsBtn').style.display = state.cheatsEnabled ? 'inline-block' : 'none';
}

/* --------------------------------------------------------------
   CHEAT OVERLAY – centered layout with live values
   -------------------------------------------------------------- */
function buildCheatOverlay(){
  const body = document.querySelector('#cheatsBtn-overlay .overlayBody');
  body.innerHTML = '';   // clear any previous content

  // helper: creates a row for a single need
  const needRow = (key) => {
    const label = key.charAt(0).toUpperCase() + key.slice(1);
    const max   = state.ranges[key];
    const cur   = state.needs[key];
    const pct   = Math.round((cur / max) * 100);   // current % value

    // each row is a flex container: [-10%] [value] [+10%]
    return `
      <div class="cheatRow" data-key="${key}"
           style="display:flex;justify-content:center;align-items:center;margin:.6rem 0;">
        <button class="overlayBtn cheatMinus"
                onclick="cheatModifyNeed('${key}', -${Math.round(max*0.10)})">
          ‑10 %
        </button>

        <span class="cheatValue" style="min-width:4ch;text-align:center;">
          ${pct} %
        </span>

        <button class="overlayBtn cheatPlus"
                onclick="cheatModifyNeed('${key}',  ${Math.round(max*0.10)})">
          +10 %
        </button>
      </div>`;
  };

  // Title centred
  body.innerHTML += `<h3 style="text-align:center;margin-bottom:1rem;">Cheats</h3>`;

  // Add a row for each need (including the special ones)
  [
    'tiredness','stress','trauma','happiness',
    'arousal','corruption','alcohol','drugs'
  ].forEach(k => body.innerHTML += needRow(k));

  // Corruption visibility toggle (below the rows)
  body.innerHTML += `
    <div style="text-align:center;margin-top:1rem;">
      <label style="display:inline-flex;align-items:center;gap:.4rem;">
        <input type="checkbox" id="showCorrChk"
               onchange="toggleCorruptionDisplay(this)" ${state.showCorruption?'checked':''}>
        Show Corruption Bar
      </label>
    </div>`;
}

/* --------------------------------------------------------------
   UPDATE VALUES in the cheat overlay when a need changes
   -------------------------------------------------------------- */
function refreshCheatValues(){
  const rows = document.querySelectorAll('.cheatRow');
  rows.forEach(row=>{
    const key   = row.dataset.key;
    const max   = state.ranges[key];
    const cur   = state.needs[key];
    const pct   = Math.round((cur / max) * 100);
    row.querySelector('.cheatValue').textContent = `${pct} %`;
  });
}

/* --------------------------------------------------------------
   Hook the refresh into the existing need‑update flow
   -------------------------------------------------------------- */
function cheatModifyNeed(key, delta){
  const max = state.ranges[key];
  const min = 0;
  state.needs[key] = Math.min(max, Math.max(min, state.needs[key] + delta));
  updateNeedsUI();          // existing UI update
  refreshCheatValues();     // keep cheat overlay in sync
}

/* --------------------------------------------------------------
   CHEAT HELPERS
   -------------------------------------------------------------- */
function cheatModifyNeed(key, delta){
  const max = state.ranges[key];
  const min = 0;
  state.needs[key] = Math.min(max, Math.max(min, state.needs[key] + delta));
  updateNeedsUI();
}

/* optional money cheat – keeps two‑decimal precision */
function cheatMoney(delta){
  state.money = Math.round((state.money + delta) * 100) / 100;
  updateHeader();
}

/* toggle the hidden “Corruption” bar */
function toggleCorruptionDisplay(cb){
  state.showCorruption = cb.checked;
  updateNeedsUI();
}

/* --------------------------------------------------------------
   INITIALISATION
   -------------------------------------------------------------- */
document.getElementById('startBtn').addEventListener('click', () => {
  // Switch to the main game screen
  switchScreen('gameScreen');

  // Initialise dynamic values
  state.money = 0.00;
  updateHeader();          // date | time | money row
  updateNeedsUI();         // draw need bars (all green at start)

  // Build UI pieces that depend on JS
  initBottomButtons();    // hook up the bottom‑button bar
  buildCheatOverlay();    // populate the Cheats overlay

  // Show the first intro event
  showCurrentEvent();
});

</script>
</body>
</html>